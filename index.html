<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3dvr-mind</title>
  <link rel="icon" href="https://fav.farm/🧠" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
</head>
<body class="bg-black text-white font-mono p-6">

  <h1 class="text-3xl mb-4">🧠 3dvr-mind</h1>

  <div id="file-structure" class="space-y-2"></div>

  <div class="mt-6">
    <input id="new-name" class="text-black p-2" placeholder="New file or folder name" />
    <select id="new-type" class="text-black p-2">
      <option value="file">File</option>
      <option value="folder">Folder</option>
    </select>
    <button onclick="addItem()" class="bg-green-600 px-4 py-2 rounded">Add</button>
  </div>

  <script>
    const gun = Gun();
    const mind = gun.get('3dvr-mind');

    function renderItem(name, data) {
      const el = document.createElement('div');
      el.className = 'pl-4 border-l border-gray-600';

      const label = document.createElement('span');
      label.textContent = `${data.type === 'folder' ? '📁' : '📄'} ${name}`;
      label.contentEditable = true;
      label.className = "cursor-pointer";
      label.onblur = () => {
        const newName = label.textContent.trim().replace(/^📁 |^📄 /, '');
        if (newName && newName !== name) {
          const newItem = { ...data, name: newName };
          mind.get(newName).put(newItem);
          mind.get(name).put(null); // Optionally delete old
          load();
        }
      };
      el.appendChild(label);

      if (data.type === 'folder') {
        mind.get(name).get('children').map().once((childData, childName) => {
          if (!childData || !childData.type) return;
          el.appendChild(renderItem(childName, childData));
        });
      }

      return el;
    }

    function load() {
      document.getElementById('file-structure').innerHTML = '';
      mind.map().once((data, key) => {
        if (!data || !data.type) return;
        document.getElementById('file-structure').appendChild(renderItem(key, data));
      });
    }

    function addItem() {
      const name = document.getElementById('new-name').value.trim();
      const type = document.getElementById('new-type').value;
      if (!name) return;

      const newItem = { type, name };
      mind.get(name).put(newItem);
      if (type === 'folder') mind.get(name).get('children').put({}); // init children

      document.getElementById('new-name').value = '';
      load();
    }

    load();
  </script>
</body>
</html>
